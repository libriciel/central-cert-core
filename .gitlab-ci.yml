image: gradle

stages:
    - test
    - package

variables:
  GRADLE_USER_HOME: $CI_PROJECT_DIR/core/.gradle
  PROJECT_NAME: "atteste"

junit:
  stage: test
  coverage: '/Total.*?([0-9]{1,3})%/'
  script:
    - cd core
    - gradle test

sonarqube:
  stage: test
  only:
    - develop # SonarQube Community is limited to one branch. 'develop' is the most relevant.
  script:
    - gradle sonar -Dsonar.host.url=https://sonarqube.libriciel.fr "-Dsonar.login=$SONAR_TOKEN"

jar:
  stage: package
  script:
    - cd core
    - sed -i "s/{VERSION}/$CI_COMMIT_REF_NAME/g" build.gradle
    - gradle bootJar
